import{r as i,m as ce,c as F,b as n,d as m,J as s,e as o,E as l,u as a,N as C,a8 as k,L as _,K as M,M as p,P,T as j,D as q,F as me,ac as pe,ad as ve}from"./@vue-Cc5W6W03.js";import{u as fe,a as ge}from"./vue-router-Yx5yAxkf.js";import{D as _e,j as K,k as he,C as W,F as xe,J as ye,p as be,t as we,v as Ce,u as ke}from"./@firebase-7dTA5crF.js";import{_ as $e,i as Ve,c as O,a as S,b as Q,l as De}from"./index-B_BK-3TZ.js";import{_ as Ee,a as Ie,b as Te,c as Ue,d as Se}from"./SelectScrollDownButton-DKQIfbde.js";import{F as Be,J as Le,M as Fe,P as Me}from"./radix-vue-g1r_MIx6.js";import{F as R}from"./vue-sonner-tOpOM8Nc.js";import{_ as Pe}from"./AdminSidebar-D7ex7HFn.js";import{_ as je,a as Re,b as Ne,c as Ae,d as Je,e as ze,f as Ge,g as He,h as qe}from"./TagsInputItemText-Bs6ifx4e.js";import{o as Ke}from"./@vueuse-CclTXppY.js";import{Q as We}from"./@vueup-DIdmzq_R.js";import"./idb-BXWtuYvb.js";import"./tslib-BGVaTf34.js";import"./class-variance-authority-Bb4qSo10.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-3VKOpVsw.js";import"./firebase-wUg9X9TS.js";import"./@heroicons-D7NO6Ex3.js";import"./vuex-F4EPD-zj.js";import"./@unovis-B91CR5fh.js";import"./@emotion-Dz_S_Xyw.js";import"./stylis-YPZU7XtI.js";import"./d3-transition-fhQpLGwb.js";import"./d3-dispatch-kxCwF96_.js";import"./d3-timer-DdKHrDhs.js";import"./d3-interpolate-DY0Cqdkz.js";import"./d3-color-Ceo1QMNe.js";import"./d3-selection-DSeOx27A.js";import"./d3-ease-Ox4sgw_u.js";import"./d3-interpolate-path-CTc7ZuM7.js";import"./striptags-PW3Qp06w.js";import"./@excalidraw-_WJHnpoj.js";import"./react-D1sI5Brr.js";import"./react-dom-9hUPJye5.js";import"./scheduler-CzFDRTuY.js";import"./to-px-DReLD3CO.js";import"./parse-unit-3UrBcP19.js";import"./d3-array-BJvpcdQ_.js";import"./@juggle-C8OzoCMD.js";import"./d3-axis-Cf4shvhW.js";import"./d3-scale-A6k9qkjg.js";import"./internmap-BkD7Hj8s.js";import"./d3-format-CzD4bSOQ.js";import"./d3-time-format-COsUQkot.js";import"./d3-time-B8hJ2rEE.js";import"./d3-shape-D7Hvm6M3.js";import"./d3-path-CimkQT29.js";import"./throttle-debounce-BnOnwhtV.js";import"./embla-carousel-vue-Dcvag-wm.js";import"./embla-carousel-reactive-utils-DkegjUUZ.js";import"./embla-carousel-QtEXB4oT.js";import"./embla-carousel-autoplay-0OO14Ffu.js";import"./@radix-icons-Ce5A0lVI.js";import"./vuex-persistedstate-D4njCX8q.js";import"./maska-Cp-LWreF.js";import"./@internationalized-D5LszBdy.js";import"./@swc-BOtJyCjG.js";import"./@floating-ui-rhRhKn_Q.js";import"./quill-delta-C63kYdZt.js";import"./fast-diff-DNDSwfiB.js";import"./lodash.clonedeep-C-QOR6T9.js";import"./lodash.isequal-xhmjsZxp.js";const $=V=>(pe("data-v-a2d75014"),V=V(),ve(),V),Oe={class:"bg-gray-100 min-h-screen flex ml-16"},Qe={class:"flex flex-col flex-1 px-4 py-6"},Xe={class:"flex items-center justify-between mb-6"},Ze=$(()=>o("h1",{class:"text-3xl font-semibold text-gray-700"},"Edit Course",-1)),Ye={key:0,class:"relative flex-1 bg-white rounded-lg shadow-md p-4 backdrop-blur-sm mx-auto max-w-5xl"},et={class:"flex space-x-4"},tt={class:"w-1/3"},at=$(()=>o("label",{class:"block text-sm font-medium"},"Course Image",-1)),st={key:0,class:"space-y-1 text-center mx-6 mt-5 mb-6"},ot=$(()=>o("svg",{class:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true"},[o("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),lt={class:"flex text-sm text-gray-600"},rt=$(()=>o("p",{class:"text-xs font-normal text-gray-500"},[o("a",{class:"font-medium text-indigo-600"},"Upload a file"),p(" or drag and drop JPG, JPEG, PNG, WEBP up to 5MB ")],-1)),it={key:1,class:"relative w-full h-full"},ut=["src"],nt={key:0,class:"text-xs text-red-500 mt-1"},dt={class:"flex-1"},ct={class:"text-xs text-gray-500 mt-1"},mt={key:0,class:"text-xs text-red-500 mt-1"},pt={key:1,class:"text-xs text-red-500 mt-1"},vt={class:"flex space-x-4"},ft={class:"flex-1"},gt={class:"flex gap-2 flex-wrap items-center px-3"},_t={class:"w-1/3"},ht={class:"flex items-center space-x-2"},xt={class:"flex justify-end"},yt={key:1,class:"text-center mt-8"},bt=$(()=>o("p",{class:"text-xl font-semibold"},"Loading course data...",-1)),wt=[bt],Ct={__name:"EditCourse",setup(V){const X=fe(),B=ge(),h=X.params.id,d=i(null),f=i(""),x=i(""),D=i(null),g=i(null),E=i(""),c=i([]),y=i(!1),v=i(""),u=i({value:1,unit:"Days"}),b=i(!0),I=i(!1),T=i(!1),N=i(!1),L=i(!1),U=_e(Ve,"learningManagementSystem/tempestStudios/courses"),A=i([]),Z=async()=>{const r=K(U,h),e=await he(r);e.exists()?(d.value={id:e.id,...e.data()},f.value=d.value.title,x.value=d.value.description,c.value=d.value.courseCategory,u.value=d.value.length,g.value=d.value.image):(console.log("No such document!"),R.error("Course not found"),B.push("/admin/courses"))},Y=async()=>{const r=await W(U),e=[];r.forEach(t=>{const w=t.data().courseCategory;Array.isArray(w)&&e.push(...w)}),A.value=Array.from(new Set(e))};ce(()=>{Z(),Y()});const ee=F(()=>A.value.filter(r=>!c.value.includes(r))),te=r=>{c.value.push(r.toLowerCase()),v.value="",y.value=!1},ae=()=>{v.value.trim()!==""&&!c.value.includes(v.value.toLowerCase())&&(c.value.push(v.value.trim().toLowerCase()),v.value="")};Ke(()=>{y.value=!1});const J=r=>r.charAt(0).toUpperCase()+r.slice(1),se=async()=>{const r=/^(?!.*\s$)(?!\s)[a-zA-Z0-9- ]{4,}$/;if(b.value=r.test(f.value),b.value&&f.value!==d.value.title){const e=xe(U,ye("title","==",f.value)),t=await W(e);I.value=!t.empty}else I.value=!1},z=r=>{const e=r.target.files[0];if(e&&e.size<=5*1024*1024&&["image/jpeg","image/png","image/webp"].includes(e.type)){const t=new FileReader;t.onload=w=>{g.value=w.target.result},t.readAsDataURL(e),E.value=null,D.value=e}else E.value="Invalid file. Please upload a JPG, JPEG, PNG, or WEBP file up to 5MB."},oe=r=>{const e=r.dataTransfer.files[0];z({target:{files:[e]}})},le=()=>{document.getElementById("file-upload-hidden").click()},re=()=>{g.value=null,D.value=null,document.getElementById("file-upload-hidden").value=null},ie=[{label:"Half-Days",value:"Half-Days"},{label:"Days",value:"Days"},{label:"Weeks",value:"Weeks"},{label:"Months",value:"Months"}],ue=()=>{u.value.value=u.value.value.replace(/[^0-9]/g,""),u.value.value===""&&(u.value.value=1)},G=F(()=>u.value.value!==""&&parseInt(u.value.value)>0),H=F(()=>b.value&&!I.value&&x.value.trim()!==""&&c.value.length>0&&G.value),ne=async()=>{if(!H.value)return;let r=d.value.image;if(D.value){const t=be(De,`company-specific/tempest-studios/learning/courses/images/${h}`);await we(t,D.value),r=await Ce(t)}const e={title:f.value,description:x.value,image:r,length:{value:parseInt(u.value.value),unit:u.value.unit},courseCategory:c.value};try{const t=K(U,h);await ke(t,e),R.success("Course updated successfully!"),B.push("/admin/courses")}catch(t){console.error("Error updating document: ",t),R.error("Failed to update course. Please try again.")}},de=()=>{B.push(`/admin/courses/${h}/sessions`)};return(r,e)=>(n(),m("div",Oe,[s(Pe,{class:"shadow-2xl"}),o("div",Qe,[o("div",Xe,[Ze,s(a(O),{onClick:de,class:"bg-green-600 hover:bg-green-700 text-white"},{default:l(()=>[p(" Edit Sessions ")]),_:1})]),d.value?(n(),m("div",Ye,[o("form",{onSubmit:C(ne,["prevent"]),class:"space-y-4"},[o("div",et,[o("div",tt,[at,o("div",{class:k(["mt-1 flex justify-center items-center border-2 border-gray-300 border-dashed rounded-md cursor-pointer overflow-hidden relative",{"border-none":g.value||d.value.image}]),onDragover:e[2]||(e[2]=C(()=>{},["prevent"])),onDrop:C(oe,["prevent"]),onClick:le},[!g.value&&!d.value.image?(n(),m("div",st,[ot,o("div",lt,[rt,o("input",{id:"file-upload-hidden",ref:"fileInput",name:"file-upload-hidden",type:"file",class:"sr-only",onChange:z,accept:".jpg,.jpeg,.png,.webp"},null,544)])])):(n(),m("div",it,[o("img",{src:g.value||d.value.image,alt:"Course image preview",class:"w-full h-full object-cover rounded-md"},null,8,ut),o("div",{class:k(["absolute top-0 right-0 bg-black text-white w-6 h-6 rounded-full flex items-center justify-center cursor-pointer",{"bg-red-500":L.value}]),onClick:C(re,["stop"]),onMouseover:e[0]||(e[0]=t=>L.value=!0),onMouseleave:e[1]||(e[1]=t=>L.value=!1)}," X ",34)]))],34),E.value?(n(),m("p",nt,_(E.value),1)):M("v-if",!0)]),o("div",dt,[s(a(S),{class:"block text-sm font-medium"},{default:l(()=>[p("Course Title")]),_:1}),s(a(Q),{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=t=>f.value=t),type:"text",class:k(["mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",{"focus:ring-red-500 border-red-500":T.value&&!b.value}]),required:"",onInput:se,onBlur:e[4]||(e[4]=t=>T.value=!0)},null,8,["modelValue","class"]),o("p",ct,"Course ID: "+_(a(h)),1),T.value&&!b.value?(n(),m("p",mt," Title must be at least 4 characters long and contain only letters, numbers, and dashes. ")):M("v-if",!0),T.value&&I.value?(n(),m("p",pt," This course title is already taken. ")):M("v-if",!0)])]),o("div",null,[s(a(S),{class:"block text-sm font-medium mb-2"},{default:l(()=>[p("Description")]),_:1}),s(a(We),{content:x.value,"onUpdate:content":e[5]||(e[5]=t=>x.value=t),toolbar:"essential",contentType:"html",class:"rows-4 rounded-md"},null,8,["content"])]),o("div",vt,[o("div",ft,[s(a(S),{class:"block text-sm mb-1 font-medium"},{default:l(()=>[p("Course Categories")]),_:1}),s(a(qe),{modelValue:c.value,"onUpdate:modelValue":e[10]||(e[10]=t=>c.value=t),class:"px-0 gap-0 w-full"},{default:l(()=>[o("div",gt,[(n(!0),m(P,null,j(c.value,t=>(n(),q(a(Ne),{key:t,value:t},{default:l(()=>[s(a(je),null,{default:l(()=>[p(_(J(t)),1)]),_:2},1024),s(a(Re))]),_:2},1032,["value"]))),128))]),s(a(Be),{open:y.value,"onUpdate:open":e[7]||(e[7]=t=>y.value=t),searchTerm:v.value,"onUpdate:searchTerm":e[8]||(e[8]=t=>v.value=t),class:"w-full",onClickOutside:e[9]||(e[9]=t=>y.value=!1)},{default:l(()=>[s(a(Le),{"as-child":""},{default:l(()=>[s(a(Fe),{placeholder:"Select Category...","as-child":""},{default:l(()=>[s(a(Ae),{class:k(["w-full px-3",c.value.length>0?"mt-2":""]),onKeydown:me(C(ae,["prevent"]),["enter"]),modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=t=>v.value=t)},null,8,["class","onKeydown","modelValue"])]),_:1})]),_:1}),s(a(Me),null,{default:l(()=>[s(a(Je),{position:"popper",class:"w-[--radix-popper-anchor-width] rounded-md mt-2 border bg-popover text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2"},{default:l(()=>[s(a(ze)),s(a(Ge),null,{default:l(()=>[(n(!0),m(P,null,j(ee.value,t=>(n(),q(a(He),{key:t,value:t,onSelect:w=>te(t)},{default:l(()=>[p(_(J(t)),1)]),_:2},1032,["value","onSelect"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["open","searchTerm"])]),_:1},8,["modelValue"])]),o("div",_t,[s(a(S),{class:"block text-sm mb-1 font-medium"},{default:l(()=>[p("Course Length")]),_:1}),o("div",ht,[s(a(Q),{modelValue:u.value.value,"onUpdate:modelValue":e[11]||(e[11]=t=>u.value.value=t),type:"number",class:k(["w-[60px] h-[34px]",{"focus:ring-red-500 border-red-500":N.value&&!G.value}]),onInput:ue,onBlur:e[12]||(e[12]=t=>N.value=!0)},null,8,["modelValue","class"]),s(a(Se),{modelValue:u.value.unit,"onUpdate:modelValue":e[13]||(e[13]=t=>u.value.unit=t)},{default:l(()=>[s(a(Ee),null,{default:l(()=>[s(a(Ie),{placeholder:"Filter by course type",class:"text-gray-500"},{default:l(()=>[p(_(u.value.unit.charAt(0).toUpperCase()+u.value.unit.slice(1)),1)]),_:1})]),_:1}),s(a(Te),null,{default:l(()=>[(n(),m(P,null,j(ie,t=>s(a(Ue),{key:t.value,value:t.value},{default:l(()=>[p(_(t.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])])])]),o("div",xt,[s(a(O),{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",disabled:!H.value},{default:l(()=>[p(" Update Course ")]),_:1},8,["disabled"])])],32)])):(n(),m("div",yt,wt))])]))}},Sa=$e(Ct,[["__scopeId","data-v-a2d75014"]]);export{Sa as default};
