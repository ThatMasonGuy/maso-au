import{u as O}from"./vue-router-CrvMPvpV.js";import{j as S,k as V,z as W,A as X,x as Y,y as Z}from"./@firebase-CBgXa-9_.js";import{f as q,i as k,r as A,c as b}from"./index-fh3STtDl.js";import{_ as tt}from"./AccountingSidebar-pKQpwrKS.js";import{_ as F}from"./index-CXtsQSRt.js";import{a as E,b as g,c as u,d as U,e as d,_ as B}from"./TableRow-yn4ap3en.js";import{F as j}from"./vue-sonner-B2EpXGAv.js";import{r as w,m as et,b as c,d as m,J as a,e as s,L as r,K as $,E as t,u as e,D as P,M as l,P as z,T as L}from"./@vue-DsGlF1-j.js";import"./idb-BXWtuYvb.js";import"./tslib-BGVaTf34.js";import"./radix-vue-6Z8x3TUN.js";import"./@internationalized-D5LszBdy.js";import"./@swc-BOtJyCjG.js";import"./@floating-ui-B6PpBHZy.js";import"./class-variance-authority-Bb4qSo10.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-3VKOpVsw.js";import"./firebase-BQhzl84B.js";import"./@heroicons-DH5_RU0z.js";import"./vuex--kc_uza-.js";import"./@unovis-B16_51NZ.js";import"./@emotion-Dz_S_Xyw.js";import"./stylis-YPZU7XtI.js";import"./d3-transition-fhQpLGwb.js";import"./d3-dispatch-kxCwF96_.js";import"./d3-timer-DdKHrDhs.js";import"./d3-interpolate-DY0Cqdkz.js";import"./d3-color-Ceo1QMNe.js";import"./d3-selection-DSeOx27A.js";import"./d3-ease-Ox4sgw_u.js";import"./d3-interpolate-path-CTc7ZuM7.js";import"./striptags-CDKagow6.js";import"./@vueup-qMjKR5Ws.js";import"./quill-delta-COPIFlMW.js";import"./fast-diff-DNDSwfiB.js";import"./lodash.clonedeep-CrPEM4m0.js";import"./lodash.isequal-CemT60YI.js";import"./to-px-DReLD3CO.js";import"./parse-unit-3UrBcP19.js";import"./d3-array-BJvpcdQ_.js";import"./@juggle-C8OzoCMD.js";import"./d3-axis-Cf4shvhW.js";import"./d3-scale-A6k9qkjg.js";import"./internmap-BkD7Hj8s.js";import"./d3-format-CzD4bSOQ.js";import"./d3-time-format-COsUQkot.js";import"./d3-time-B8hJ2rEE.js";import"./d3-shape-D7Hvm6M3.js";import"./d3-path-CimkQT29.js";import"./throttle-debounce-BnOnwhtV.js";import"./embla-carousel-vue-CXHqejTr.js";import"./embla-carousel-reactive-utils-DkegjUUZ.js";import"./embla-carousel-QtEXB4oT.js";import"./@vueuse-H75eWtDf.js";import"./embla-carousel-autoplay-0OO14Ffu.js";import"./@radix-icons-C7iqcNif.js";import"./vuex-persistedstate-D4njCX8q.js";import"./maska-Cp-LWreF.js";import"./TooltipTrigger-Bqh97bnl.js";const at={class:"bg-gray-100 min-h-screen flex ml-16"},st={class:"flex-1 p-8"},ot=s("h1",{class:"text-3xl font-bold mb-8"},"Transaction Details",-1),lt={key:0,class:"flex justify-center items-center h-64"},nt=s("div",{class:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900"},null,-1),rt=[nt],it={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert"},ct=s("strong",{class:"font-bold"},"Error! ",-1),ut={class:"block sm:inline"},dt={key:2},_t={class:"bg-white shadow-md rounded-lg p-6 mb-6"},mt={class:"flex justify-between items-start mb-6"},pt={class:"text-2xl font-semibold"},ft={class:"text-gray-600"},vt={key:0,class:"text-gray-600"},ht={class:"space-y-2"},yt={class:"mb-6"},bt=s("h3",{class:"text-xl font-semibold mb-2"},"Related Party Information",-1),gt={class:"mb-6"},wt=s("h3",{class:"text-xl font-semibold mb-2"},"Transaction Items",-1),xt={class:"text-right"},Dt={class:"text-lg"},Tt={class:"text-lg"},kt={class:"text-xl font-bold"},$t={key:0,class:"bg-white shadow-md rounded-lg p-6"},Pt=s("h3",{class:"text-xl font-semibold mb-4"},"Recent Transactions for This Party",-1),It={key:3,class:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded relative",role:"alert"},Rt=s("strong",{class:"font-bold"},"No data! ",-1),Ct=s("br",null,null,-1),Nt=s("span",{class:"block sm:inline"},"No transaction data available.",-1),St=[Rt,Ct,Nt],Be={__name:"TransactionDetails",setup(Vt){const I=O(),o=w(null),x=w([]),R=w(!0),D=w(null);et(async()=>{const i=I.params.id,f=I.params.type;try{await M(i,f),await G(o.value.clientID)}catch(n){D.value="Failed to load transaction data. Please try again later.",console.error("Error fetching transaction data:",n)}finally{R.value=!1}});const M=async(i,f)=>{const n=q.currentUser.uid,v=S(k,`users/${n}/accounting/settings/${f}s/${i}`),_=await V(v);if(_.exists()){o.value={id:_.id,..._.data()};const h=S(k,`users/${n}/accounting/settings/contacts/${o.value.clientID}`),y=await V(h);y.exists()&&(o.value.relatedParty=y.data())}else throw new Error("Transaction not found")},G=async i=>{const f=q.currentUser.uid,n=["invoices","quotes","receipts"];let v=[];for(const _ of n){const h=W(Y(k,`users/${f}/accounting/settings/${_}`),X("clientID","==",i)),y=await Z(h);v=[...v,...y.docs.map(N=>({id:N.id,type:_.slice(0,-1),...N.data()}))]}x.value=v.sort((_,h)=>new Date(h.issueDate||h.receiptDate)-new Date(_.issueDate||_.receiptDate)).slice(0,5)},T=i=>new Intl.DateTimeFormat("en-AU",{year:"numeric",month:"long",day:"numeric"}).format(new Date(i)),p=i=>new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD"}).format(i),C=i=>{switch(i){case"paid":return"success";case"pending":return"warning";case"overdue":return"destructive";default:return"default"}},J=()=>{j.success("Transaction download started")},K=()=>{j.success("Receipt generated successfully")},Q=()=>{o.value&&o.value.relatedParty&&A.push(`/auth/accounting/clients/${o.value.relatedParty.id}`)},H=i=>{A.push(`/auth/accounting/transactions/${i}`)};return(i,f)=>(c(),m("div",at,[a(tt,{class:"shadow-2xl"}),s("div",st,[ot,R.value?(c(),m("div",lt,rt)):D.value?(c(),m("div",it,[ct,s("span",ut,r(D.value),1)])):o.value?(c(),m("div",dt,[s("div",_t,[s("div",mt,[s("div",null,[s("h2",pt,r(o.value.type)+" #"+r(o.value.number),1),s("p",ft,"Date: "+r(T(o.value.date)),1),o.value.dueDate?(c(),m("p",vt,"Due Date: "+r(T(o.value.dueDate)),1)):$("v-if",!0)]),s("div",ht,[a(e(F),{variant:C(o.value.status)},{default:t(()=>[l(r(o.value.status),1)]),_:1},8,["variant"]),a(e(b),{onClick:J,class:"w-full"},{default:t(()=>[l("Download")]),_:1}),o.value.type==="Invoice"&&o.value.status==="paid"?(c(),P(e(b),{key:0,onClick:K,class:"w-full"},{default:t(()=>[l("Generate Receipt")]),_:1})):$("v-if",!0)])]),s("div",yt,[bt,s("p",null,r(o.value.relatedParty.name),1),s("p",null,r(o.value.relatedParty.email),1),s("p",null,r(o.value.relatedParty.phone),1),a(e(b),{onClick:Q,class:"mt-2"},{default:t(()=>[l("View Details")]),_:1})]),s("div",gt,[wt,a(e(B),null,{default:t(()=>[a(e(E),null,{default:t(()=>[a(e(g),null,{default:t(()=>[a(e(u),null,{default:t(()=>[l("Description")]),_:1}),a(e(u),null,{default:t(()=>[l("Quantity")]),_:1}),a(e(u),null,{default:t(()=>[l("Price")]),_:1}),a(e(u),null,{default:t(()=>[l("Total")]),_:1})]),_:1})]),_:1}),a(e(U),null,{default:t(()=>[(c(!0),m(z,null,L(o.value.items,n=>(c(),P(e(g),{key:n.id},{default:t(()=>[a(e(d),null,{default:t(()=>[l(r(n.description),1)]),_:2},1024),a(e(d),null,{default:t(()=>[l(r(n.quantity),1)]),_:2},1024),a(e(d),null,{default:t(()=>[l(r(p(n.price)),1)]),_:2},1024),a(e(d),null,{default:t(()=>[l(r(p(n.quantity*n.price)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),s("div",xt,[s("p",Dt,"Subtotal: "+r(p(o.value.subtotal)),1),s("p",Tt,"Tax: "+r(p(o.value.tax)),1),s("p",kt,"Total: "+r(p(o.value.total)),1)])]),x.value.length>0?(c(),m("div",$t,[Pt,a(e(B),null,{default:t(()=>[a(e(E),null,{default:t(()=>[a(e(g),null,{default:t(()=>[a(e(u),null,{default:t(()=>[l("Type")]),_:1}),a(e(u),null,{default:t(()=>[l("Number")]),_:1}),a(e(u),null,{default:t(()=>[l("Date")]),_:1}),a(e(u),null,{default:t(()=>[l("Amount")]),_:1}),a(e(u),null,{default:t(()=>[l("Status")]),_:1}),a(e(u),null,{default:t(()=>[l("Action")]),_:1})]),_:1})]),_:1}),a(e(U),null,{default:t(()=>[(c(!0),m(z,null,L(x.value,n=>(c(),P(e(g),{key:n.id},{default:t(()=>[a(e(d),null,{default:t(()=>[l(r(n.type),1)]),_:2},1024),a(e(d),null,{default:t(()=>[l(r(n.number),1)]),_:2},1024),a(e(d),null,{default:t(()=>[l(r(T(n.date)),1)]),_:2},1024),a(e(d),null,{default:t(()=>[l(r(p(n.total)),1)]),_:2},1024),a(e(d),null,{default:t(()=>[a(e(F),{variant:C(n.status)},{default:t(()=>[l(r(n.status),1)]),_:2},1032,["variant"])]),_:2},1024),a(e(d),null,{default:t(()=>[a(e(b),{onClick:v=>H(n.id),variant:"outline",size:"sm"},{default:t(()=>[l("View")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):$("v-if",!0)])):(c(),m("div",It,St))])]))}};export{Be as default};
