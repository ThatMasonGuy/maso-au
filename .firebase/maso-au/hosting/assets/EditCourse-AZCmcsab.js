import{r as i,m as ce,c as M,b as n,d as m,J as s,e as l,E as o,u as a,N as C,a8 as k,L as _,K as F,M as p,P,T as j,D as q,F as me,ad as pe,ae as ve}from"./@vue-DsGlF1-j.js";import{u as fe,a as ge}from"./vue-router-CrvMPvpV.js";import{x as _e,j as K,k as he,y as W,z as xe,A as ye,B as be,C as we,D as Ce,u as ke}from"./@firebase-CBgXa-9_.js";import{_ as $e,i as Ve,c as O,a as B,b as Q,m as De}from"./index-fh3STtDl.js";import{_ as Ee,a as Ie,b as Te,c as Ue,d as Be}from"./SelectScrollDownButton-BK2d6S2D.js";import{E as Se,F as Le,J as Me,M as Fe}from"./radix-vue-6Z8x3TUN.js";import{F as R}from"./vue-sonner-B2EpXGAv.js";import{_ as Pe}from"./AdminSidebar-DAKwD2Ft.js";import{_ as je,a as Re,b as Ne,c as Ae,d as ze,e as Ge,f as Je,g as He,h as qe}from"./TagsInputItemText-sWmi6ADl.js";import{o as Ke}from"./@vueuse-H75eWtDf.js";import{Q as We}from"./@vueup-qMjKR5Ws.js";import"./idb-BXWtuYvb.js";import"./tslib-BGVaTf34.js";import"./class-variance-authority-Bb4qSo10.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-3VKOpVsw.js";import"./firebase-BQhzl84B.js";import"./@heroicons-DH5_RU0z.js";import"./vuex--kc_uza-.js";import"./@unovis-B16_51NZ.js";import"./@emotion-Dz_S_Xyw.js";import"./stylis-YPZU7XtI.js";import"./d3-transition-fhQpLGwb.js";import"./d3-dispatch-kxCwF96_.js";import"./d3-timer-DdKHrDhs.js";import"./d3-interpolate-DY0Cqdkz.js";import"./d3-color-Ceo1QMNe.js";import"./d3-selection-DSeOx27A.js";import"./d3-ease-Ox4sgw_u.js";import"./d3-interpolate-path-CTc7ZuM7.js";import"./striptags-CDKagow6.js";import"./to-px-DReLD3CO.js";import"./parse-unit-3UrBcP19.js";import"./d3-array-BJvpcdQ_.js";import"./@juggle-C8OzoCMD.js";import"./d3-axis-Cf4shvhW.js";import"./d3-scale-A6k9qkjg.js";import"./internmap-BkD7Hj8s.js";import"./d3-format-CzD4bSOQ.js";import"./d3-time-format-COsUQkot.js";import"./d3-time-B8hJ2rEE.js";import"./d3-shape-D7Hvm6M3.js";import"./d3-path-CimkQT29.js";import"./throttle-debounce-BnOnwhtV.js";import"./embla-carousel-vue-CXHqejTr.js";import"./embla-carousel-reactive-utils-DkegjUUZ.js";import"./embla-carousel-QtEXB4oT.js";import"./embla-carousel-autoplay-0OO14Ffu.js";import"./@radix-icons-C7iqcNif.js";import"./vuex-persistedstate-D4njCX8q.js";import"./maska-Cp-LWreF.js";import"./@internationalized-D5LszBdy.js";import"./@swc-BOtJyCjG.js";import"./@floating-ui-B6PpBHZy.js";import"./quill-delta-COPIFlMW.js";import"./fast-diff-DNDSwfiB.js";import"./lodash.clonedeep-CrPEM4m0.js";import"./lodash.isequal-CemT60YI.js";const $=V=>(pe("data-v-a2d75014"),V=V(),ve(),V),Oe={class:"bg-gray-100 min-h-screen flex ml-16"},Qe={class:"flex flex-col flex-1 px-4 py-6"},Xe={class:"flex items-center justify-between mb-6"},Ze=$(()=>l("h1",{class:"text-3xl font-semibold text-gray-700"},"Edit Course",-1)),Ye={key:0,class:"relative flex-1 bg-white rounded-lg shadow-md p-4 backdrop-blur-sm mx-auto max-w-5xl"},et={class:"flex space-x-4"},tt={class:"w-1/3"},at=$(()=>l("label",{class:"block text-sm font-medium"},"Course Image",-1)),st={key:0,class:"space-y-1 text-center mx-6 mt-5 mb-6"},lt=$(()=>l("svg",{class:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true"},[l("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),ot={class:"flex text-sm text-gray-600"},rt=$(()=>l("p",{class:"text-xs font-normal text-gray-500"},[l("a",{class:"font-medium text-indigo-600"},"Upload a file"),p(" or drag and drop JPG, JPEG, PNG, WEBP up to 5MB ")],-1)),it={key:1,class:"relative w-full h-full"},ut=["src"],nt={key:0,class:"text-xs text-red-500 mt-1"},dt={class:"flex-1"},ct={class:"text-xs text-gray-500 mt-1"},mt={key:0,class:"text-xs text-red-500 mt-1"},pt={key:1,class:"text-xs text-red-500 mt-1"},vt={class:"flex space-x-4"},ft={class:"flex-1"},gt={class:"flex gap-2 flex-wrap items-center px-3"},_t={class:"w-1/3"},ht={class:"flex items-center space-x-2"},xt={class:"flex justify-end"},yt={key:1,class:"text-center mt-8"},bt=$(()=>l("p",{class:"text-xl font-semibold"},"Loading course data...",-1)),wt=[bt],Ct={__name:"EditCourse",setup(V){const X=fe(),S=ge(),h=X.params.id,d=i(null),f=i(""),x=i(""),D=i(null),g=i(null),E=i(""),c=i([]),y=i(!1),v=i(""),u=i({value:1,unit:"Days"}),b=i(!0),I=i(!1),T=i(!1),N=i(!1),L=i(!1),U=_e(Ve,"learningManagementSystem/tempestStudios/courses"),A=i([]),Z=async()=>{const r=K(U,h),e=await he(r);e.exists()?(d.value={id:e.id,...e.data()},f.value=d.value.title,x.value=d.value.description,c.value=d.value.courseCategory,u.value=d.value.length,g.value=d.value.image):(console.log("No such document!"),R.error("Course not found"),S.push("/admin/courses"))},Y=async()=>{const r=await W(U),e=[];r.forEach(t=>{const w=t.data().courseCategory;Array.isArray(w)&&e.push(...w)}),A.value=Array.from(new Set(e))};ce(()=>{Z(),Y()});const ee=M(()=>A.value.filter(r=>!c.value.includes(r))),te=r=>{c.value.push(r.toLowerCase()),v.value="",y.value=!1},ae=()=>{v.value.trim()!==""&&!c.value.includes(v.value.toLowerCase())&&(c.value.push(v.value.trim().toLowerCase()),v.value="")};Ke(()=>{y.value=!1});const z=r=>r.charAt(0).toUpperCase()+r.slice(1),se=async()=>{const r=/^(?!.*\s$)(?!\s)[a-zA-Z0-9- ]{4,}$/;if(b.value=r.test(f.value),b.value&&f.value!==d.value.title){const e=xe(U,ye("title","==",f.value)),t=await W(e);I.value=!t.empty}else I.value=!1},G=r=>{const e=r.target.files[0];if(e&&e.size<=5*1024*1024&&["image/jpeg","image/png","image/webp"].includes(e.type)){const t=new FileReader;t.onload=w=>{g.value=w.target.result},t.readAsDataURL(e),E.value=null,D.value=e}else E.value="Invalid file. Please upload a JPG, JPEG, PNG, or WEBP file up to 5MB."},le=r=>{const e=r.dataTransfer.files[0];G({target:{files:[e]}})},oe=()=>{document.getElementById("file-upload-hidden").click()},re=()=>{g.value=null,D.value=null,document.getElementById("file-upload-hidden").value=null},ie=[{label:"Half-Days",value:"Half-Days"},{label:"Days",value:"Days"},{label:"Weeks",value:"Weeks"},{label:"Months",value:"Months"}],ue=()=>{u.value.value=u.value.value.replace(/[^0-9]/g,""),u.value.value===""&&(u.value.value=1)},J=M(()=>u.value.value!==""&&parseInt(u.value.value)>0),H=M(()=>b.value&&!I.value&&x.value.trim()!==""&&c.value.length>0&&J.value),ne=async()=>{if(!H.value)return;let r=d.value.image;if(D.value){const t=be(De,`company-specific/tempest-studios/learning/courses/images/${h}`);await we(t,D.value),r=await Ce(t)}const e={title:f.value,description:x.value,image:r,length:{value:parseInt(u.value.value),unit:u.value.unit},courseCategory:c.value};try{const t=K(U,h);await ke(t,e),R.success("Course updated successfully!"),S.push("/admin/courses")}catch(t){console.error("Error updating document: ",t),R.error("Failed to update course. Please try again.")}},de=()=>{S.push(`/admin/courses/${h}/sessions`)};return(r,e)=>(n(),m("div",Oe,[s(Pe,{class:"shadow-2xl"}),l("div",Qe,[l("div",Xe,[Ze,s(a(O),{onClick:de,class:"bg-green-600 hover:bg-green-700 text-white"},{default:o(()=>[p(" Edit Sessions ")]),_:1})]),d.value?(n(),m("div",Ye,[l("form",{onSubmit:C(ne,["prevent"]),class:"space-y-4"},[l("div",et,[l("div",tt,[at,l("div",{class:k(["mt-1 flex justify-center items-center border-2 border-gray-300 border-dashed rounded-md cursor-pointer overflow-hidden relative",{"border-none":g.value||d.value.image}]),onDragover:e[2]||(e[2]=C(()=>{},["prevent"])),onDrop:C(le,["prevent"]),onClick:oe},[!g.value&&!d.value.image?(n(),m("div",st,[lt,l("div",ot,[rt,l("input",{id:"file-upload-hidden",ref:"fileInput",name:"file-upload-hidden",type:"file",class:"sr-only",onChange:G,accept:".jpg,.jpeg,.png,.webp"},null,544)])])):(n(),m("div",it,[l("img",{src:g.value||d.value.image,alt:"Course image preview",class:"w-full h-full object-cover rounded-md"},null,8,ut),l("div",{class:k(["absolute top-0 right-0 bg-black text-white w-6 h-6 rounded-full flex items-center justify-center cursor-pointer",{"bg-red-500":L.value}]),onClick:C(re,["stop"]),onMouseover:e[0]||(e[0]=t=>L.value=!0),onMouseleave:e[1]||(e[1]=t=>L.value=!1)}," X ",34)]))],34),E.value?(n(),m("p",nt,_(E.value),1)):F("v-if",!0)]),l("div",dt,[s(a(B),{class:"block text-sm font-medium"},{default:o(()=>[p("Course Title")]),_:1}),s(a(Q),{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=t=>f.value=t),type:"text",class:k(["mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",{"focus:ring-red-500 border-red-500":T.value&&!b.value}]),required:"",onInput:se,onBlur:e[4]||(e[4]=t=>T.value=!0)},null,8,["modelValue","class"]),l("p",ct,"Course ID: "+_(a(h)),1),T.value&&!b.value?(n(),m("p",mt," Title must be at least 4 characters long and contain only letters, numbers, and dashes. ")):F("v-if",!0),T.value&&I.value?(n(),m("p",pt," This course title is already taken. ")):F("v-if",!0)])]),l("div",null,[s(a(B),{class:"block text-sm font-medium mb-2"},{default:o(()=>[p("Description")]),_:1}),s(a(We),{content:x.value,"onUpdate:content":e[5]||(e[5]=t=>x.value=t),toolbar:"essential",contentType:"html",class:"rows-4 rounded-md"},null,8,["content"])]),l("div",vt,[l("div",ft,[s(a(B),{class:"block text-sm mb-1 font-medium"},{default:o(()=>[p("Course Categories")]),_:1}),s(a(qe),{modelValue:c.value,"onUpdate:modelValue":e[10]||(e[10]=t=>c.value=t),class:"px-0 gap-0 w-full"},{default:o(()=>[l("div",gt,[(n(!0),m(P,null,j(c.value,t=>(n(),q(a(Ne),{key:t,value:t},{default:o(()=>[s(a(je),null,{default:o(()=>[p(_(z(t)),1)]),_:2},1024),s(a(Re))]),_:2},1032,["value"]))),128))]),s(a(Se),{open:y.value,"onUpdate:open":e[7]||(e[7]=t=>y.value=t),searchTerm:v.value,"onUpdate:searchTerm":e[8]||(e[8]=t=>v.value=t),class:"w-full",onClickOutside:e[9]||(e[9]=t=>y.value=!1)},{default:o(()=>[s(a(Le),{"as-child":""},{default:o(()=>[s(a(Me),{placeholder:"Select Category...","as-child":""},{default:o(()=>[s(a(Ae),{class:k(["w-full px-3",c.value.length>0?"mt-2":""]),onKeydown:me(C(ae,["prevent"]),["enter"]),modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=t=>v.value=t)},null,8,["class","onKeydown","modelValue"])]),_:1})]),_:1}),s(a(Fe),null,{default:o(()=>[s(a(ze),{position:"popper",class:"w-[--radix-popper-anchor-width] rounded-md mt-2 border bg-popover text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2"},{default:o(()=>[s(a(Ge)),s(a(Je),null,{default:o(()=>[(n(!0),m(P,null,j(ee.value,t=>(n(),q(a(He),{key:t,value:t,onSelect:w=>te(t)},{default:o(()=>[p(_(z(t)),1)]),_:2},1032,["value","onSelect"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["open","searchTerm"])]),_:1},8,["modelValue"])]),l("div",_t,[s(a(B),{class:"block text-sm mb-1 font-medium"},{default:o(()=>[p("Course Length")]),_:1}),l("div",ht,[s(a(Q),{modelValue:u.value.value,"onUpdate:modelValue":e[11]||(e[11]=t=>u.value.value=t),type:"number",class:k(["w-[60px] h-[34px]",{"focus:ring-red-500 border-red-500":N.value&&!J.value}]),onInput:ue,onBlur:e[12]||(e[12]=t=>N.value=!0)},null,8,["modelValue","class"]),s(a(Be),{modelValue:u.value.unit,"onUpdate:modelValue":e[13]||(e[13]=t=>u.value.unit=t)},{default:o(()=>[s(a(Ee),null,{default:o(()=>[s(a(Ie),{placeholder:"Filter by course type",class:"text-gray-500"},{default:o(()=>[p(_(u.value.unit.charAt(0).toUpperCase()+u.value.unit.slice(1)),1)]),_:1})]),_:1}),s(a(Te),null,{default:o(()=>[(n(),m(P,null,j(ie,t=>s(a(Ue),{key:t.value,value:t.value},{default:o(()=>[p(_(t.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])])])]),l("div",xt,[s(a(O),{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",disabled:!H.value},{default:o(()=>[p(" Update Course ")]),_:1},8,["disabled"])])],32)])):(n(),m("div",yt,wt))])]))}},Ea=$e(Ct,[["__scopeId","data-v-a2d75014"]]);export{Ea as default};
