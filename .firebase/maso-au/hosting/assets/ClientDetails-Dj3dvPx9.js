import{u as H}from"./vue-router-Yx5yAxkf.js";import{j as K,k as O,F as G,J as Q,D as W,C as X}from"./@firebase-7dTA5crF.js";import{h as Y,f as B,i as E,c as N,r as Z}from"./index-B_BK-3TZ.js";import{_ as tt}from"./AccountingSidebar-BbxZfPyK.js";import{_ as $,a as C,b as k,c as F}from"./CardContent-cdWgGs_w.js";import{b as d,d as m,q as et,a8 as st,u as t,r as g,m as at,J as s,e as a,L as l,K as y,E as e,D as q,M as n,P as ot,T as nt}from"./@vue-Cc5W6W03.js";import{_ as lt,a as it,b as A,c as _,d as rt,e as p}from"./TableRow-CZeARrAJ.js";import{_ as V}from"./index-Cs7elnvn.js";import{F as ct}from"./vue-sonner-tOpOM8Nc.js";import"./idb-BXWtuYvb.js";import"./tslib-BGVaTf34.js";import"./radix-vue-g1r_MIx6.js";import"./@internationalized-D5LszBdy.js";import"./@swc-BOtJyCjG.js";import"./@floating-ui-rhRhKn_Q.js";import"./class-variance-authority-Bb4qSo10.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-3VKOpVsw.js";import"./firebase-wUg9X9TS.js";import"./@heroicons-D7NO6Ex3.js";import"./vuex-F4EPD-zj.js";import"./@unovis-B91CR5fh.js";import"./@emotion-Dz_S_Xyw.js";import"./stylis-YPZU7XtI.js";import"./d3-transition-fhQpLGwb.js";import"./d3-dispatch-kxCwF96_.js";import"./d3-timer-DdKHrDhs.js";import"./d3-interpolate-DY0Cqdkz.js";import"./d3-color-Ceo1QMNe.js";import"./d3-selection-DSeOx27A.js";import"./d3-ease-Ox4sgw_u.js";import"./d3-interpolate-path-CTc7ZuM7.js";import"./striptags-PW3Qp06w.js";import"./@excalidraw-_WJHnpoj.js";import"./react-D1sI5Brr.js";import"./react-dom-9hUPJye5.js";import"./scheduler-CzFDRTuY.js";import"./to-px-DReLD3CO.js";import"./parse-unit-3UrBcP19.js";import"./d3-array-BJvpcdQ_.js";import"./@juggle-C8OzoCMD.js";import"./d3-axis-Cf4shvhW.js";import"./d3-scale-A6k9qkjg.js";import"./internmap-BkD7Hj8s.js";import"./d3-format-CzD4bSOQ.js";import"./d3-time-format-COsUQkot.js";import"./d3-time-B8hJ2rEE.js";import"./d3-shape-D7Hvm6M3.js";import"./d3-path-CimkQT29.js";import"./throttle-debounce-BnOnwhtV.js";import"./embla-carousel-vue-Dcvag-wm.js";import"./embla-carousel-reactive-utils-DkegjUUZ.js";import"./embla-carousel-QtEXB4oT.js";import"./@vueuse-CclTXppY.js";import"./embla-carousel-autoplay-0OO14Ffu.js";import"./@radix-icons-Ce5A0lVI.js";import"./vuex-persistedstate-D4njCX8q.js";import"./maska-Cp-LWreF.js";import"./TooltipTrigger-CQaA16an.js";const dt={__name:"CardFooter",props:{class:{type:null,required:!1}},setup(T){const I=T;return(c,f)=>(d(),m("div",{class:st(t(Y)("flex items-center p-6 pt-0",I.class))},[et(c.$slots,"default")],2))}},ut={class:"bg-gray-100 min-h-screen flex ml-16"},mt={class:"flex-1 p-8"},_t=a("h1",{class:"text-3xl font-bold mb-8"},"Client Details",-1),pt={key:0,class:"flex justify-center items-center h-64"},ft=a("div",{class:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900"},null,-1),vt=[ft],ht={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert"},gt=a("strong",{class:"font-bold"},"Error!",-1),yt={class:"block sm:inline"},bt={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},xt={class:"space-y-2"},It=a("strong",null,"Name:",-1),wt=a("strong",null,"Email:",-1),Dt=a("strong",null,"Phone:",-1),$t=a("strong",null,"Address:",-1),Ct={class:"grid grid-cols-2 gap-4"},kt=a("h3",{class:"text-lg font-semibold"},"Total Invoiced",-1),Ft={class:"text-2xl font-bold text-green-600"},Tt=a("h3",{class:"text-lg font-semibold"},"Outstanding Balance",-1),St={class:"text-2xl font-bold text-red-600"},Bt=a("h3",{class:"text-lg font-semibold"},"Paid Invoices",-1),Et={class:"text-2xl font-bold"},Nt=a("h3",{class:"text-lg font-semibold"},"Pending Invoices",-1),qt={class:"text-2xl font-bold"},At={key:4,class:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded relative",role:"alert"},Vt=a("strong",{class:"font-bold"},"No data!",-1),Pt=a("span",{class:"block sm:inline"},"No client data available.",-1),Ut=[Vt,Pt],Re={__name:"ClientDetails",setup(T){const I=H(),c=g(null),f=g([]),v=g({totalInvoiced:0,outstandingBalance:0,paidInvoices:0,pendingInvoices:0}),w=g(!0),b=g(null);at(async()=>{const o=I.params.id;try{await P(o),await U(o),j()}catch(i){b.value="Failed to load client data. Please try again later.",console.error("Error fetching client data:",i)}finally{w.value=!1}});const P=async o=>{const i=B.currentUser.uid,r=K(E,`users/${i}/accounting/settings/contacts/${o}`),u=await O(r);if(u.exists())c.value={id:u.id,...u.data()};else throw new Error("Client not found")},U=async o=>{const i=B.currentUser.uid,r=["invoices","quotes","receipts"];let u=[];for(const h of r){const x=G(W(E,`users/${i}/accounting/settings/${h}`),Q("clientID","==",o)),R=await X(x);u=[...u,...R.docs.map(S=>({id:S.id,type:h.slice(0,-1),...S.data()}))]}f.value=u.sort((h,x)=>new Date(x.issueDate||x.receiptDate)-new Date(h.issueDate||h.receiptDate))},j=()=>{v.value=f.value.reduce((o,i)=>(i.type==="income"&&(o.totalInvoiced+=i.amount,i.status==="pending"?(o.outstandingBalance+=i.amount,o.pendingInvoices++):(i.status==="paid"||i.status==="completed")&&o.paidInvoices++),o),{totalInvoiced:0,outstandingBalance:0,paidInvoices:0,pendingInvoices:0})},z=o=>new Intl.DateTimeFormat("en-AU",{year:"numeric",month:"long",day:"numeric"}).format(new Date(o)),D=o=>new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD"}).format(o),J=o=>{switch(o){case"paid":case"completed":return"success";case"pending":return"warning";case"overdue":return"destructive";default:return"default"}},L=()=>{ct.info("Edit client functionality not implemented yet")},M=o=>{Z.push(`/auth/accounting/transactions/${o.id}`)};return(o,i)=>(d(),m("div",ut,[s(tt,{class:"shadow-2xl"}),a("div",mt,[_t,w.value?(d(),m("div",pt,vt)):b.value?(d(),m("div",ht,[gt,a("span",yt,l(b.value),1)])):c.value?(d(),m("div",bt,[y(" Client Information Card "),s(t(F),{class:"md:col-span-1"},{default:e(()=>[s(t($),null,{default:e(()=>[s(t(C),null,{default:e(()=>[n("Contact Information")]),_:1})]),_:1}),s(t(k),null,{default:e(()=>[a("div",xt,[a("p",null,[It,n(" "+l(c.value.name),1)]),a("p",null,[wt,n(" "+l(c.value.email),1)]),a("p",null,[Dt,n(" "+l(c.value.phone),1)]),a("p",null,[$t,n(" "+l(c.value.address),1)])])]),_:1}),s(t(dt),null,{default:e(()=>[s(t(N),{onClick:L},{default:e(()=>[n("Edit Client")]),_:1})]),_:1})]),_:1}),y(" Financial Summary Card "),s(t(F),{class:"md:col-span-2"},{default:e(()=>[s(t($),null,{default:e(()=>[s(t(C),null,{default:e(()=>[n("Financial Summary")]),_:1})]),_:1}),s(t(k),null,{default:e(()=>[a("div",Ct,[a("div",null,[kt,a("p",Ft,l(D(v.value.totalInvoiced)),1)]),a("div",null,[Tt,a("p",St,l(D(v.value.outstandingBalance)),1)]),a("div",null,[Bt,a("p",Et,l(v.value.paidInvoices),1)]),a("div",null,[Nt,a("p",qt,l(v.value.pendingInvoices),1)])])]),_:1})]),_:1})])):y("v-if",!0),y(" Transactions Table "),c.value&&f.value.length>0?(d(),q(t(F),{key:3,class:"mt-6"},{default:e(()=>[s(t($),null,{default:e(()=>[s(t(C),null,{default:e(()=>[n("Transaction History")]),_:1})]),_:1}),s(t(k),null,{default:e(()=>[s(t(lt),null,{default:e(()=>[s(t(it),null,{default:e(()=>[s(t(A),null,{default:e(()=>[s(t(_),null,{default:e(()=>[n("Date")]),_:1}),s(t(_),null,{default:e(()=>[n("Description")]),_:1}),s(t(_),null,{default:e(()=>[n("Type")]),_:1}),s(t(_),null,{default:e(()=>[n("Amount")]),_:1}),s(t(_),null,{default:e(()=>[n("Status")]),_:1}),s(t(_),null,{default:e(()=>[n("Action")]),_:1})]),_:1})]),_:1}),s(t(rt),null,{default:e(()=>[(d(!0),m(ot,null,nt(f.value,r=>(d(),q(t(A),{key:r.id},{default:e(()=>[s(t(p),null,{default:e(()=>[n(l(z(r.date)),1)]),_:2},1024),s(t(p),null,{default:e(()=>[n(l(r.description),1)]),_:2},1024),s(t(p),null,{default:e(()=>[s(t(V),{variant:r.type==="income"?"success":"destructive"},{default:e(()=>[n(l(r.type),1)]),_:2},1032,["variant"])]),_:2},1024),s(t(p),null,{default:e(()=>[n(l(D(r.amount)),1)]),_:2},1024),s(t(p),null,{default:e(()=>[s(t(V),{variant:J(r.status)},{default:e(()=>[n(l(r.status),1)]),_:2},1032,["variant"])]),_:2},1024),s(t(p),null,{default:e(()=>[s(t(N),{onClick:u=>M(r),variant:"outline",size:"sm"},{default:e(()=>[n("View")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})):!w.value&&!b.value&&!c.value?(d(),m("div",At,Ut)):y("v-if",!0)])]))}};export{Re as default};
