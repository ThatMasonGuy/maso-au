import{f as u,r as s,b as c}from"./index-BVf6JYJ_.js";import{d as w,h as p,G as f,j as A,k as h,l as d,m as g,n as y,p as b}from"./@firebase-BQ9lEHMd.js";const D=w(),E=p(D,"createUser"),C=new f,v=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,R=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&#%^&/.,><';":])[A-Za-z\d@$!%*?&#%^&/.,><';":]{8,}$/;A(c,async r=>{if(r)try{const e=h(u,"users",r.uid);(await d(e)).exists()||await g(e,{firstName:"",lastName:"",userName:"",emailAddress:r.email,phoneNumber:"",dateOfBirth:"",avatarUrl:""});const o=s.currentRoute.value;o.meta.requiresAuth&&o.meta.requiresAuth&&!r&&s.push("/login")}catch(e){console.error("Error in onAuthStateChanged:",e)}else s.currentRoute.value.meta.requiresAuth&&s.push("/login")});const I=async(r,e,t,o,n,l,i,m)=>{try{if(console.log("Validating user input"),!v.test(o))throw new Error("Invalid email format");if(!R.test(i))throw new Error("Password must be at least 8 characters long, contain at least 1 symbol, 1 number, 1 capital, and 1 lowercase letter");if(i!==m)throw new Error("Passwords do not match");const a=new Date;if(a.setFullYear(a.getFullYear()-12),new Date(l)>a)throw new Error("You must be at least 12 years old to sign up");console.log("Trimming input fields"),r=r.trim(),e=e.trim(),t=t.trim(),o=o.trim(),n=n.trim(),console.log("Calling createUser Cloud Function");const P=await E({firstName:r,lastName:e,userName:t,emailAddress:o,phoneNumber:n,dateOfBirth:l,password:i});console.log("User created successfully"),s.push("/home")}catch(a){throw console.error("Error creating user:",a),a}},F=async(r,e)=>{try{await y(c,r,e),s.push("/home")}catch(t){throw console.error("Error signing in:",t),t}},G=async()=>{try{const e=(await b(c,C)).user,t=h(u,"users",e.uid);(await d(t)).exists()||await g(t,{firstName:"",lastName:"",userName:"",emailAddress:e.email,phoneNumber:"",dateOfBirth:"",avatarUrl:""}),s.push("/home")}catch(r){throw console.error("Error signing in with Google:",r),r}};export{G as a,I as b,F as s};
